import Foundation
import SwaggerClientSupport

open class {{{apiClassName}}}Class: SwaggerApi {
{{#each methods}}
    {{~#maybeComment description}}
    {{{description}}}
    {{/maybeComment}}
    {{#each params}}
    {{~#maybeComment description}}
    - parameter {{{name}}}: {{{description}}}
    {{/maybeComment}}
    {{/each}}
    open func {{{name}}}(
    {{#each params}}
        {{{name}}}: {{{type}}}{{#unless required}}? = nil{{/unless}},
    {{/each}}
        timeout: TimeInterval? = nil,
        completion: @escaping ({{{response.type}}}?, ErrorResponse?) -> Void
    ) {
        self.request(method: .{{{method}}}, path: "{{{path}}}", timeout: timeout, params: [
        {{#each params}}
            .init(name: "{{{serverName}}}", in: .{{{in}}}, value: {{{name}}}, format: {{#if format}}"{{format}}"{{else}}nil{{/if}}) {{~#unless @last}},{{/unless}}
        {{/each}}
        ], completion: completion)
    }

{{/each}}
}

public let {{{apiClassName}}} = {{{apiClassName}}}Class()


{{#each objectModels}}
open class {{{name}}}: {{#if superclass}}{{{superclass}}}{{else}}SwaggerModel{{/if}} {
{{#with schema}}
    {{#each properties}}
    {{~#maybeComment description}}
    {{{description}}}
    {{/maybeComment}}
    public var {{{name}}}: {{{type}}}{{#unless isRequired}}?{{/unless}}
    {{/each}}

    public init(
    {{#each initializerProperties}}
        {{{name}}}: {{{type}}} {{~#unless isRequired}}?=nil{{/unless}} {{~#unless @last}},{{/unless}}
    {{/each}}
    ) {
    {{#each properties}}
        self.{{{name}}} = {{{name}}}
    {{/each}}
    {{~#if ../superclass}}
        super.init(
        {{#each inheritedProperties}}
            {{{name}}}: {{{name}}} {{~#unless @last}},{{/unless}}
        {{/each}}
        )
    {{/if}}
    }

    {{#if ../superclass}}override {{/if}}public func serialize(format: String? = nil) -> Any? {
        let retVal: [String: Any?] = [
        {{#each properties}}
            "{{{specName}}}": {{{name}}}{{#unless isRequired}}?{{/unless}}.serialize(format: {{#if format}}"{{format}}"{{else}}nil{{/if}}),
        {{/each}}
        ]
        return retVal.filter { (_: String, val: Any?) -> Bool in return val != nil }
    }

    {{#if ../superclass}}override {{/if}}public class func deserialize(json: Any?, format: String? = nil) -> Self {
        guard let dictionary = json as? [String: Any] else {
            fatalError("Deserialization error: Trying to deserialize a {{{../name}}} but got \(String(describing: json))")
        }
        return self.init(
        {{#each initializerProperties}}
            {{{name}}}: {{#unless isRequired}}Optional<{{/unless}}{{{type}}}{{#unless isRequired}}>{{/unless}}.deserialize(json: dictionary["{{{specName}}}"], format: {{#if format}}"{{format}}"{{else}}nil{{/if}}){{#unless @last}},{{/unless}}
        {{/each}}
        )
    }
{{/with}}
}

{{/each}}

{{#each enumModels}}
public enum {{{name}}}: {{{schema.enumType}}}, SwaggerEnum {
{{#with schema}}
    {{#each values}}
    case {{{name}}} = {{{value}}}
    {{/each}}
    public func serialize(format: String? = nil) -> Any? {
        return rawValue;
    }
    public func serializeToString(format: String? = nil) -> String? {
        return rawValue.serializeToString(format: format);
    }
    public static func deserialize(json: Any?, format: String? = nil) -> {{{../name}}} {
        guard let asType = json as? {{{enumType}}},
            let asEnum = {{{../name}}}(rawValue: asType) else {
            fatalError("Deserialization error: Trying to deserialize a {{{../name}}}, expected {{{enumType}}} but got \(String(describing: json))")
        }
        return asEnum
    }
{{/with}}
}

{{/each}}
